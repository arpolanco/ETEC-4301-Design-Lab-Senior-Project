<!DOCTYPE HTML>
<HTML>
	<HEAD>
		<TITLE>Drone Settings</TITLE>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	</HEAD>
	<BODY>
		<H1>
			<u>Drone Settings Page</u>
		</H1>
		<div>
			<p>
				This Page can be used to change the K values on the drone while in flight.
			</p>
            DRONE:
            <INPUT type="number" value="0" name="drone" id="droneBox">
            
            </br>	
            PITCH:..
            <br/>
            <span id="pkp">
                KP:
                <button  
                <INPUT type="range" name="K P P" min="0" max="255" scale="kpd" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KPP" scale="kpd">Apply</button>
            </span>
            <br/>
            <span id="pki">
                KI: <INPUT type="range" name="K P I" min="0" max="255" scale="ki" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KPI" scale="ki">Apply</button>
            </span>
            <br/>
            <span id="pkd">
                KD: <INPUT type="range" name="K P D" min="0" max="255" scale="kpd" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KPD" scale="kpd">Apply</button>
            </span>
            <br/>
        
            <br/>
            <br/>
            ROLL:....
            <br/>
            <span id="rkp">
                KP: <INPUT type="range" name="K R P" min="0" max="255" scale="kpd" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KRP" scale="kpd">Apply</button>
            </span>
            <br/>
            <span id="rki">
                KI: <INPUT type="range" name="K R  I" min="0" max="255" scale="ki" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KRI" scale="ki">Apply</button>
            </span>
            <br/>
            <span id="rkd">
                KD: <INPUT type="range" name="K R D" min="0" max="255" scale="kpd" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KRD" scale="kpd">Apply</button>
            </span>
            <br/>
            
            </br>
            <br/>
            YAW:....
            <br/>
            <span id="rkp">
                KP: <INPUT type="range" name="K Y P" min="0" max="255" scale="kpd" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KYP" scale="kpd">Apply</button>
            </span>
            <br/>
            <span id="rki">
                KI: <INPUT type="range" name="R Y I" min="0" max="255" scale="ki" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KYI" scale="ki">Apply</button>
            </span>
            <br/>
            <span id="rkd">
                KD: <INPUT type="range" name="R Y D" min="0" max="255" scale="kpd" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="KYD" scale="kpd">Apply</button>
            </span>
            <br/>
            <br/>
            THROTTLE...
            <br/>
            <span id="throttle">
                KD: <INPUT type="range" name="throttle" min="0" max="127" scale="throttle" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="throttle" scale="throttle">Apply</button>
            </span>
            <br/>
            <br/>
            PITCH...
            <br/>
            <span id="pitch">
                KD: <INPUT type="range" name="pitch" min="0" max="14" scale="pr" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="pitch" scale="pr">Apply</button>
            </span>
            <br/>
            <br/>
            YAW...
            <br/>
            <span id="yaw">
                KD: <INPUT type="range" name="yaw" min="0" max="14" scale="yaw" class="range"> 
                <span>Not changed</span>
                <button class="applyBtn" name="yaw" scale="yaw">Apply</button>
            </span>
            <br/>
            <br/>
            ROLL...
            <br/>
            <span id="roll">
                KD: <INPUT type="range" name="roll" min="0" max="14" scale="pr" class="range">
                <span>Not changed</span>
                <button class="applyBtn" name="roll" scale="pr">Apply</button>
            </span>
            <br/>
		</div>
	</BODY>
    <script>
        $(document).ready(function(){
            $('input[type=range]').change(function(){
                var val = 0;
                var scale = $(this).attr('scale');
                if(scale == "kpd"){
                    val = ($(this).val() / 256.0) * 5;
                }
                else if(scale == "ki"){
                    val = ($(this).val() / 256.0);
                }
                else if(scale == "throttle" || scale == "pr" || scale == "yaw"){
                    val = $(this).val();
                }
                $(this).parent().find('span').text(val);
            });
            $('.applyBtn').click(function(){
                var req = new XMLHttpRequest();
                var url = window.location.href;
                if (url.slice(-1) != '/')
                    url +=  '/';
                url += '?drone=';
                url += $('#droneBox').val()
                url += '&';
                url +=  $(this).prop('name');
                url += '='
                url += $(this).parent().find('input').val();
                console.log(url);
                req.open('GET',  url);
                req.send();
            });
        });	
    </script>
</HTML>
